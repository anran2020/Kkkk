/**
 ******************************************************************************
 * 文件:iap_def.h
 * 作者:   zzx
 * 版本:   V0.01
 * 日期:     2014-12-01
 * 内容简介:
 *
 ******************************************************************************
 *  					文件历史
 *
 * 版本号-----  日期   -----   作者    ------   说明
 * v0.1     2014-12-01          zzx                 创建该文件
 *
 *
 *
 ******************************************************************************
 **/

#ifndef  __IAP_DEF_H__
#define  __IAP_DEF_H__

//----------------------------------------------------------------------------
//includes
//----------------------------------------------------------------------------
#include "mlos_dtd.h"


//----------------------------------------------------------------------------
//文件条件编译
//----------------------------------------------------------------------------
#if 1

//----------------------------------------------------------------------------
//define config
//----------------------------------------------------------------------------


//----------------------------------------------------------------------------
//define
//----------------------------------------------------------------------------

//----------------------------------------------------------------------------
//define 
//----------------------------------------------------------------------------

typedef void (*APP_MAIN_FUNC)(void);						//app主函数
typedef void (*BOOT_MAIN_FUNC)(void);						//boot 主函数


#define BOOT_RUNNING 			0			//正在运行boot
#define APP_RUNNING 			1			//正在运行app

//----------------------------------------------------------------------------
//升级状态
//----------------------------------------------------------------------------
typedef enum{

	e_iap_sta_wait=0,
	e_iap_sta_ready,
	e_iap_sta_upgrade,
	e_iap_sta_verify,
	
}IAPState;
	
//----------------------------------------------------------------------------
//APP 文件信息
//----------------------------------------------------------------------------
typedef struct {

	
	mlu32 size;
	

	union {
		
		mlu32 modify;		//文件修改时间
		
	};

	mlu32 rsv[30];			//升级计数

	//修改记录
	
		
}AppFileInfo,*AppFileInfoPtr;

//----------------------------------------------------------------------------
//	升级错误
//----------------------------------------------------------------------------
typedef enum {

	e_iap_err_null=0,
	e_iap_err_fileSize,					//文件大小
	e_iap_err_flashErase,				//插除flash错误
	e_iap_err_flashWrite,				//插除flash错误
	e_iap_err_packetSeq,			//帧序错误
	e_iap_err_WriteAppFileInfo,				//写app 文件信息 错误

}IapError;




//----------------------------------------------------------------------------
//
//----------------------------------------------------------------------------


//----------------------------------------------------------------------------
// 
//----------------------------------------------------------------------------



//----------------------------------------------------------------------------
// export fun 
//----------------------------------------------------------------------------
void iap_init(void);

#ifdef COMPILE_BOOT_CODE

void iap_be_ready(void);														//iap，就绪
MLBool iap_run_app(void);														//运行app		
IapError iap_start(mlu32 binfileSize,mlu32 packetSize);							//启动升级
IapError iap_data(mlu32 packetSeq,mlu32 validBytes,mlu32* pData);				//升级文件数据
void iap_backup(mlu32 packetSeq,mlu32 packetSize,mlu32* pData);					//备份

#else

MLBool iap_run_boot(void);

#endif

//----------------------------------------------------------------------------
//							end  of file
//----------------------------------------------------------------------------
#endif//条件编译
#endif//编译一次



