/**
 ******************************************************************************
 * 文件:port.h
 * 作者:   zzx
 * 版本:   V0.01
 * 日期:     2014-12-01
 * 内容简介:
 *
 ******************************************************************************
 *  					文件历史
 *
 * 版本号-----  日期   -----   作者    ------   说明
 * v0.1                       2014-12-01          zzx                 创建该文件
 *
 *
 *
 ******************************************************************************
 **/

//----------------------------------------------------------------------------
// 文件条件编译
//----------------------------------------------------------------------------
#if 1

#ifndef  _PORT_H__
#define  _PORT_H__
 
//----------------------------------------------------------------------------
//includes
//----------------------------------------------------------------------------
#include "stm32f10x.h"
#include "mlos_dtd.h"


//----------------------------------------------------------------------------
// mlos 需要用到的硬件 timer define
//----------------------------------------------------------------------------

//延时定时器
#define DELAY_TIMER 				TIM6
#define DELAY_TIMER_CLK 			RCC_APB1Periph_TIM6

//任务计时定时器
#define TASK_TIMING_TIMER 				TIM7
#define TASK_TIMING_TIMER_CLK 			RCC_APB1Periph_TIM7


//-----------------------------------------------------------------------------
// 函数名：
//-----------------------------------------------------------------------------
//
// 返回值 : void
// 参数   :  void
//
//
//
//功能描述：
//
//
//修改履历：
//1.zzx ：  2014-12-01  ：创建函数
//
//-----------------------------------------------------------------------------
_inline void port_clock_us_delay(u16 us)
{
	//TIM_TypeDef* timx=BASIC_TIM;
	DELAY_TIMER->CR1 =0;
	//DELAY_TIMER->ARR=(us-1);
	DELAY_TIMER->SR=0;
	DELAY_TIMER->CNT=0;
	DELAY_TIMER->CR1 = 1;
	while (DELAY_TIMER->CNT<us)
	{
		;
	}
	DELAY_TIMER->CR1 =0;

}

//-----------------------------------------------------------------------------
// 函数名：
//-----------------------------------------------------------------------------
//
// 返回值 : void
// 参数   :  void
//
//
//
//功能描述：
//
//
//修改履历：
//1.zzx ：  2014-12-01  ：创建函数
//
//-----------------------------------------------------------------------------
_inline void task_clock_start(void)
{
	//	TIM_TypeDef* timx=BASIC_TIM;
	TASK_TIMING_TIMER->CR1 =0;
	//TIMING_TIMER->ARR=(60000-1);
	TASK_TIMING_TIMER->SR=0;
	TASK_TIMING_TIMER->CNT=0;
	TASK_TIMING_TIMER->CR1 = TIM_CR1_CEN;
	
}

//-----------------------------------------------------------------------------
// 函数名：
//-----------------------------------------------------------------------------
//
// 返回值 : void
// 参数   :  void
//
//
//
//功能描述：
//
//
//修改履历：
//1.zzx ：  2014-12-01  ：创建函数
//
//-----------------------------------------------------------------------------
_inline u16 task_clock_stop(void)
{

	TASK_TIMING_TIMER->CR1 =0;
	if(TASK_TIMING_TIMER->SR)
	return 65535;
	else
	return TASK_TIMING_TIMER->CNT;

}


//----------------------------------------------------------------------------
//export fun
//----------------------------------------------------------------------------

// 供 mlos clock 调用
void port_clock_init(void);

//给 mlos malloc 调用
void port_mem_init(void);


//----------------------------------------------------------------------------
// end of file
//----------------------------------------------------------------------------
#endif
#endif

