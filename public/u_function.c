/**
 ******************************************************************************
 * 文件:    
 * 作者:   
 * 版本:   V0.01
 * 日期:     2014-12-01
 * 内容简介:  
 *          
 ******************************************************************************
 *  					文件历史
 *
 * 版本号-----  日期   -----   作者    ------   说明
 * v0.1        2014-12-01                           创建该文件
 *
 *
 *
 ******************************************************************************
 **/



#include"u_function.h"

//---------------------------------------------------------------------------
// 名    称：
//---------------------------------------------------------------------------
//功    能：无描述
//
//入口参数：无
//
//出口参数：无
//
//修改记录：
//
//下面是优化效率版本，逻辑也更简洁，不用调整bit序，并由此：
//poly用倒序，异或到crc的低字节，判断最低位，将左移改为右移
//---------------------------------------------------------------------------
mlu16 crc16(mlu8 *buf, mlu16 len)
{
    mlu16 crc = 0xffff;  /*modbus要求为0xffff*/
    mlu16 poly = 0xa001;  /*优化后，用0xa001,即0x8005的倒序*/
    mlu8 cnt;

    while(len--)
    {
        crc ^= *buf++;  /*优化后，将src异或到crc的低字节*/
        for (cnt=0; cnt<8; cnt++)
        {
            if (crc & 0x0001)  /*优化后判断crc最低位，为1则*/
            {
                crc >>= 1;  /*优化后，右移一位*/
                crc ^= poly;  /*再与poly异或*/
            }
            else  /*否则 优化后只右移一位*/
            {
                crc >>= 1;
            }
        }
    }

    return crc;
	
}


//----------------------------------------------------------------------------
//							end  of file
//----------------------------------------------------------------------------


